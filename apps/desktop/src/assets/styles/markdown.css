/* ============================================================
   MARKDOWN & CODE BLOCK STYLES
   ============================================================ */

/* Markdown token bridge (Incremark -> app tokens) */
[data-component="markdown"] {
  line-height: 1.75;
  color: var(--foreground);
}

[data-component="markdown"] .incremark-theme-provider {
  --incremark-color-text-primary: var(--foreground);
  --incremark-color-text-secondary: oklch(from var(--foreground) l c h / 0.85);
  --incremark-color-text-tertiary: var(--muted-foreground);
  --incremark-color-text-inverse: var(--background);
  --incremark-color-background-base: transparent;
  --incremark-color-background-elevated: oklch(from var(--muted) l c h / 0.6);
  --incremark-color-background-overlay: oklch(from var(--background) l c h / 0.8);
  --incremark-color-border-subtle: oklch(from var(--border) l c h / 0.35);
  --incremark-color-border-default: oklch(from var(--border) l c h / 0.58);
  --incremark-color-border-strong: oklch(from var(--border) l c h / 0.85);
  --incremark-color-brand-primary: var(--primary);
  --incremark-color-brand-primary-hover: oklch(from var(--primary) l c h / 0.86);
  --incremark-color-brand-primary-active: oklch(from var(--primary) l c h / 0.74);
  --incremark-color-interactive-link: var(--primary);
  --incremark-color-interactive-link-hover: oklch(from var(--primary) l c h / 0.9);
  --incremark-color-interactive-link-visited: oklch(from var(--primary) l c h / 0.7);
  --incremark-color-interactive-checked: var(--primary);
  --incremark-color-code-inline-background: oklch(from var(--muted) l c h / 0.72);
  --incremark-color-code-inline-text: var(--foreground);
  --incremark-color-code-block-background: oklch(from var(--muted) l c h / 0.74);
  --incremark-color-code-block-text: var(--foreground);
  --incremark-color-code-header-background: oklch(from var(--card) l c h / 0.76);
  --incremark-color-status-pending: oklch(from var(--primary) l c h / 0.88);
  --incremark-color-status-completed: oklch(0.7 0.2 145);
  --incremark-typography-font-family-base: var(--font-sans);
  --incremark-typography-font-family-mono: var(--font-mono);
  --incremark-typography-font-size-base: 14px;
  --incremark-border-radius-sm: calc(var(--radius) - 4px);
  --incremark-border-radius-md: calc(var(--radius) - 2px);
  --incremark-border-radius-lg: var(--radius);
}

.dark [data-component="markdown"] .incremark-theme-provider {
  --incremark-color-background-elevated: oklch(from var(--muted) l c h / 0.45);
  --incremark-color-border-subtle: oklch(from var(--border) l c h / 0.32);
  --incremark-color-border-default: oklch(from var(--border) l c h / 0.5);
  --incremark-color-border-strong: oklch(from var(--border) l c h / 0.74);
  --incremark-color-code-inline-background: oklch(from var(--accent) l c h / 0.6);
  --incremark-color-code-block-background: oklch(from var(--muted) l c h / 0.5);
  --incremark-color-code-header-background: oklch(from var(--card) l c h / 0.72);
}

[data-component="markdown"] .incremark {
  background: transparent;
  color: var(--foreground);
  min-height: auto;
}

[data-component="markdown"] .incremark-block {
  margin: 0.65rem 0;
}

[data-component="markdown"] .incremark-block.incremark-show-status.incremark-pending,
[data-component="markdown"] .incremark-block.incremark-show-status.pending {
  border-left-color: oklch(from var(--primary) l c h / 0.62);
  padding-left: 0.9rem;
  opacity: 1;
}

[data-component="markdown"] h1,
[data-component="markdown"] h2,
[data-component="markdown"] h3,
[data-component="markdown"] h4,
[data-component="markdown"] h5,
[data-component="markdown"] h6 {
  font-weight: 650;
  letter-spacing: -0.025em;
  line-height: 1.3;
  margin-top: 1.3em;
  margin-bottom: 0.5em;
  color: var(--foreground);
}

[data-component="markdown"] h1 {
  font-size: 1.2rem;
  border-bottom: 1px solid oklch(from var(--border) l c h / 0.45);
  padding-bottom: 0.35rem;
}

[data-component="markdown"] h2 {
  font-size: 1.08rem;
}

[data-component="markdown"] h3 {
  font-size: 1.01rem;
}

[data-component="markdown"] p {
  margin-top: 0.48em;
  margin-bottom: 0.48em;
  color: oklch(from var(--foreground) l c h / 0.93);
}

[data-component="markdown"] a {
  color: var(--primary);
  text-decoration: none;
  text-underline-offset: 0.18em;
  text-decoration-thickness: 1px;
}

[data-component="markdown"] a:hover {
  text-decoration: underline solid oklch(from var(--primary) l c h / 0.6);
}

[data-component="markdown"] .incremark-inline-code,
[data-component="markdown"] code:not(pre code) {
  border-radius: calc(var(--radius) - 2px);
  background-color: oklch(from var(--muted) l c h / 0.8);
  border: 1px solid oklch(from var(--border) l c h / 0.45);
  padding: 0.12rem 0.34rem;
  font-size: 0.83rem;
  font-family: var(--font-mono);
  color: oklch(from var(--foreground) l c h / 0.96);
  word-break: break-word;
}

[data-component="markdown"] .incremark-code {
  border: 1px solid oklch(from var(--border) l c h / 0.6);
  border-radius: var(--radius);
  background: oklch(from var(--muted) l c h / 0.52);
  box-shadow: var(--shadow-xs);
}

[data-component="markdown"] .incremark-code .code-header {
  border-bottom: 1px solid oklch(from var(--border) l c h / 0.56);
  backdrop-filter: blur(8px);
}

[data-component="markdown"] .incremark-code .language {
  color: oklch(from var(--muted-foreground) l c h / 0.9);
  letter-spacing: 0.06em;
}

[data-component="markdown"] .incremark-code .code-btn {
  border: 1px solid oklch(from var(--border) l c h / 0.55);
  background: oklch(from var(--card) l c h / 0.62);
}

[data-component="markdown"] .incremark-code .code-btn:hover {
  background: oklch(from var(--accent) l c h / 0.75);
  border-color: oklch(from var(--primary) l c h / 0.38);
}

[data-component="markdown"] .shiki-wrapper pre,
[data-component="markdown"] .code-fallback,
[data-component="markdown"] .code-loading pre,
[data-component="markdown"] pre {
  background: transparent;
  padding: 0.85rem 1rem;
  margin: 0;
  overflow-x: auto;
}

[data-component="markdown"] .shiki-wrapper code,
[data-component="markdown"] .code-fallback code,
[data-component="markdown"] pre code {
  padding: 0;
  background: transparent;
  border: 0;
  color: inherit;
  font-size: 0.82rem;
  line-height: 1.6;
}

[data-component="markdown"] .incremark-blockquote,
[data-component="markdown"] blockquote {
  border-left: 3px solid oklch(from var(--primary) l c h / 0.55);
  background: oklch(from var(--muted) l c h / 0.45);
  border-radius: 0 var(--radius) var(--radius) 0;
  padding: 0.68rem 1rem;
  color: oklch(from var(--foreground) l c h / 0.86);
}

[data-component="markdown"] ul,
[data-component="markdown"] ol {
  padding-left: 1.35rem;
  margin: 0.6rem 0;
}

[data-component="markdown"] li {
  color: oklch(from var(--foreground) l c h / 0.93);
  margin: 0.3rem 0;
}

[data-component="markdown"] li::marker {
  color: oklch(from var(--muted-foreground) l c h / 0.95);
}

[data-component="markdown"] hr {
  border: 0;
  border-top: 1px solid oklch(from var(--border) l c h / 0.52);
  margin: 1.3rem 0;
}

[data-component="markdown"] .incremark-table-wrapper {
  border: 1px solid oklch(from var(--border) l c h / 0.5);
  border-radius: var(--radius);
  overflow: hidden;
}

[data-component="markdown"] .incremark-table {
  background: oklch(from var(--card) l c h / 0.35);
}

[data-component="markdown"] .incremark-table th,
[data-component="markdown"] .incremark-table td {
  border-color: oklch(from var(--border) l c h / 0.5);
  padding: 0.52rem 0.8rem;
}

[data-component="markdown"] .incremark-table th {
  background: oklch(from var(--muted) l c h / 0.68);
  color: oklch(from var(--foreground) l c h / 0.96);
}

[data-component="markdown"] .incremark-table tr:nth-child(even) {
  background: oklch(from var(--muted) l c h / 0.38);
}

/* Code blocks with copy button */
[data-component="markdown-code"] {
  position: relative;
  margin: 1rem 0;
}

[data-slot="markdown-copy-button"] {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  opacity: 0;
  transition: opacity 150ms ease;
}

[data-component="markdown-code"]:hover [data-slot="markdown-copy-button"] {
  opacity: 1;
}

[data-slot="markdown-copy-button"] {
  background-color: oklch(from var(--card) l c h / 0.8);
  border: 1px solid oklch(from var(--border) l c h / 0.4);
  border-radius: calc(var(--radius) - 4px);
  padding: 0.375rem;
}

[data-slot="markdown-copy-button"]:hover {
  background-color: var(--card);
  border-color: oklch(from var(--primary) l c h / 0.3);
}

/* Syntax highlighting - dark theme compatible */
.shiki {
  background-color: transparent !important;
}

.shiki code {
  color: inherit;
  font-family: var(--font-mono);
}

/* Inline markdown for user messages */
.prose-p\:m-0 p {
  margin-top: 0;
  margin-bottom: 0;
}
